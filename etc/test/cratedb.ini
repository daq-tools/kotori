; ######################################
; Kotori test configuration with CrateDB
; ######################################


; ================
; General settings
; ================

; http server
[kotori]

; TODO: Refactor to [http] section, or, even better, into the channel configuration.
http_listen = localhost
http_port   = 24643


; =====================
; Connectivity settings
; =====================

; MQTT bus adapter
[mqtt]
host        = localhost
#port        = 1883
username    = kotori
password    = kotori

; Storage adapter
[cratedb]
; host        = localhost
; port        = 4200
; username    = crate
; password    =

; User interface
[grafana]
host        = localhost
#port        = 3000
username    = admin
password    = admin


; ================
; Channel settings
; ================

[mqttkit-2]
enable      = true
type        = application
realm       = mqttkit-2
mqtt_topics = mqttkit-2/#
application = kotori.daq.application.mqttkit:mqttkit_application

[mqttkit-2.http-api-generic]
enable          = true

type            = application
application     = kotori.io.protocol.forwarder:boot

realm           = mqttkit-2
source          = http:/api/mqttkit-2/{address:.*}/{slot:(data|event)} [POST]
target          = mqtt:/mqttkit-2/{address}/{slot}.json

[mqttkit-2.cratedb-data-export]
enable          = true

type            = application
application     = kotori.io.protocol.forwarder:boot

realm           = mqttkit-2
source          = http:/api/{realm:mqttkit-2}/{network:.*}/{gateway:.*}/{node:.*}/{slot:(data|event)}.{suffix} [GET]
target          = cratedb:/{database}?measurement={measurement}
transform       = kotori.daq.strategy.wan:WanBusStrategy.topology_to_storage,
                  kotori.io.protocol.cratedb:QueryTransformer.transform
